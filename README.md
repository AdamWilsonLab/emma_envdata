
![EMMA](img/EMMA%20Logo_RE_3.jpg)

# Ecological Monitoring and Management Application (EMMA)

This is the core repository for environmental data processing in the
Ecological Monitoring and Management Application [EMMA.io](EMMA.io).

## File structure

The most important files are:

``` r
├── _targets.R (data processing workflow and dependency management)
├── R/
├──── [data_processing_functions]
├── data/
├──── manual_download (files behind firewalls that must be manually downloaded)
├── releases/
├──── raw_... (folders containing files downloaded from earth engine)
├──── processed_... (folders containing files that have had some additional processing)
├──── current (parquet format files containing data in tabular formats)
└── Readme.Rmd (this file)
```

Files used and generated by the workflow are predominantly stored as Github releases.
The final output of the workflow is a set of parquet files stored as Github releases with the tag “current”.

## Data types and sources

# Static Data

# Dynamic Data

* Elevation: [NASADEM](https://developers.google.com/earth-engine/datasets/catalog/NASA_NASADEM_HGT_001)
* ALOS [Landforms](https://developers.google.com/earth-engine/datasets/catalog/CSP_ERGo_1_0_Global_ALOS_landforms)
* ALOS [mTPI](https://developers.google.com/earth-engine/datasets/catalog/CSP_ERGo_1_0_Global_ALOS_mTPI)
* ALOS [Topographic Diversity](https://developers.google.com/earth-engine/datasets/catalog/CSP_ERGo_1_0_Global_ALOS_topoDiversity)
* ALOS [CHILI](https://developers.google.com/earth-engine/datasets/catalog/CSP_ERGo_1_0_Global_ALOS_CHILI)


# Data notes

    * MODIS NDVI values have been transformed to save space.  To restore them to the original values (between -1 and 1), use (x/100)-1

# Workflow structure

![](README_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

# Workflow Notes

Many of the functions and data products in this repo are divided into 2 categories: "static" and "dynamic". "Static" refers to data that are not updated, or are updated only very infrequently (e.g. yearly or more).  "Dynamic" refers to data that are updated fairly regularly (e.g. monthly or bi-weekly).


## Runtime and frequency

Github places some constrains on actions, including memory limits and
run time limits. To prevent this workflow from taking too long to run
(and thereby losing all progress), there are a few key parameters that
can be changed. In the \_targets.R file, the argument “max_layers”
controls the maximum number of layers that rgee will attempt to download
in one action run. When initially setting up the repo, it may be
necessary to lower this value and increase the frequency that the
targets workflow is run (by adjusting the cron parameters in
targets.yaml).


# Extras

    * Call `targets::tar_renv(extras = character(0))` to write a `_packages.R` file to expose hidden dependencies.
    * Call `renv::init()` to initialize the `renv` lockfile `renv.lock` or `renv::snapshot()` to update it.
    * Commit `renv.lock` to your Git repository.
